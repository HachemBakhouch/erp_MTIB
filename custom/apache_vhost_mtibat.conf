# Apache VirtualHost Configuration for ERP MTIB
# Copyright (C) 2026 EVE-MEDIA - All rights reserved
#
# Domain: www.mtibat.com
# Installation path: /var/www/erp-mtib

<VirtualHost *:80>
    ServerName mtibat.com
    ServerAlias www.mtibat.com
    ServerAdmin hachem@eve-media.com

    DocumentRoot /var/www/erp-mtib/htdocs

    <Directory /var/www/erp-mtib/htdocs>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Security headers
        <IfModule mod_headers.c>
            Header set X-Content-Type-Options "nosniff"
            Header set X-Frame-Options "SAMEORIGIN"
            Header set X-XSS-Protection "1; mode=block"
            Header set Referrer-Policy "strict-origin-when-cross-origin"
        </IfModule>
    </Directory>

    # Deny access to sensitive directories
    <Directory /var/www/erp-mtib/htdocs/conf>
        Require all denied
    </Directory>

    <Directory /var/www/erp-mtib/htdocs/install>
        # Allow only during installation, then disable
        Require all granted
    </Directory>

    <Directory /var/www/erp-mtib/documents>
        Options -Indexes
        Require all denied
    </Directory>

    <Directory /var/www/erp-mtib/custom>
        Require all denied
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/erp-mtib-error.log
    CustomLog ${APACHE_LOG_DIR}/erp-mtib-access.log combined

    # PHP Configuration
    <IfModule mod_php.c>
        php_value upload_max_filesize 32M
        php_value post_max_size 32M
        php_value memory_limit 256M
        php_value max_execution_time 300
        php_value max_input_time 300
        php_flag display_errors Off
        php_flag log_errors On
        php_value error_log /var/log/php/erp-mtib-error.log
    </IfModule>

    # Rewrite rules
    <IfModule mod_rewrite.c>
        RewriteEngine On

        # Redirect to HTTPS (after SSL setup)
        # Uncomment these lines after installing SSL certificate
        # RewriteCond %{HTTPS} off
        # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    </IfModule>
</VirtualHost>

# SSL VirtualHost (activate after Let's Encrypt installation)
# Uncomment and configure after running certbot
#
# <VirtualHost *:443>
#     ServerName mtibat.com
#     ServerAlias www.mtibat.com
#     ServerAdmin hachem@eve-media.com
#
#     DocumentRoot /var/www/erp-mtib/htdocs
#
#     <Directory /var/www/erp-mtib/htdocs>
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#
#         <IfModule mod_headers.c>
#             Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
#             Header set X-Content-Type-Options "nosniff"
#             Header set X-Frame-Options "SAMEORIGIN"
#             Header set X-XSS-Protection "1; mode=block"
#             Header set Referrer-Policy "strict-origin-when-cross-origin"
#             Header set Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval'; img-src 'self' data: https:; font-src 'self' data:;"
#         </IfModule>
#     </Directory>
#
#     # Same directory restrictions as HTTP
#     <Directory /var/www/erp-mtib/htdocs/conf>
#         Require all denied
#     </Directory>
#
#     <Directory /var/www/erp-mtib/htdocs/install>
#         Require all denied
#     </Directory>
#
#     <Directory /var/www/erp-mtib/documents>
#         Options -Indexes
#         Require all denied
#     </Directory>
#
#     <Directory /var/www/erp-mtib/custom>
#         Require all denied
#     </Directory>
#
#     # SSL Configuration (will be added by certbot)
#     # SSLEngine on
#     # SSLCertificateFile /etc/letsencrypt/live/mtibat.com/fullchain.pem
#     # SSLCertificateKeyFile /etc/letsencrypt/live/mtibat.com/privkey.pem
#     # Include /etc/letsencrypt/options-ssl-apache.conf
#
#     ErrorLog ${APACHE_LOG_DIR}/erp-mtib-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/erp-mtib-ssl-access.log combined
# </VirtualHost>
